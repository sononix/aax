version: "3"

services:
  reverse-proxy:
    image: traefik #The official Traefik docker image
    command: --api --logLevel= DEBUG --docker.watch --acme --acme.storage=/etc/traefik/acme/acme.json --acme.entryPoint=https --entryPoints='Name:http Address::80' --entryPoints='Name:https Address::443 TLS' --defaultentrypoints=http,https --acme.email=admin@nua.media # This log level can also be INFO
    ports:
      - "80:80"     #The HTTP port
      - "8080:8080" #The Web UI (enabled by --api)
      - "443:443"
    labels:
       - "traefik.acme.domains=nua.media,www.nua.media"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock #So that Traefik can listen to the Docker events
      - $PWD/traefik.toml:/traefik.toml
    networks:
      - proxy
    restart:
      always

  tremage:
    image: 'test-caddy'
    labels:
      - "traefik.backend=tremage"
      - "traefik.frontend.rule=Host:www.tremage.com,tremage.com"
      - "traefik.docker.network=proxy"
      - "traefik.frontend.entryPoints: http,https"
      - "traefik.port=2015"
      - "traefik.port=443"
    volumes:
      - $PWD/Caddyfilec2o:/etc/Caddyfile
      - $PWD/tremage:/srv
      - $PWD/.caddy:/etc/caddycerts
    environment:
      - CADDYPATH=/etc/caddycerts
      - AWS_ACCESS_KEY_ID
      - AWS_SECRET_ACCESS_KEY
      - AWS_REGION
      - AWS_HOSTED_ZONE_ID
      - ACME_AGREE=true
    networks:
      - proxy
#
#   c2ostudio:
#     image: 'test-caddy'
#     labels:
#       - "traefik.backend=c2ostudio"
#       - "traefik.frontend.rule=Host:www.c2o.studio,c2o.studio"
#       - "traefik.docker.network=proxy"
#       - "traefik.port=2015"
#       - "traefik.port=443"
#     volumes:
#       - ./Caddyfilec2o:/etc/Caddyfile
#       - ./c2ostudio:/srv
#       - ./.caddy:/etc/caddycerts
#     environment:
#       - CADDYPATH=/etc/caddycerts
#     networks:
#       - traefik_webgateway
#
networks:
  proxy:
    external: true
  internal:
    external: false
